{% extends "base.html" %}

{% block title %}Configuración - Minecraft Manager{% endblock %}
{% block page_title %}Configuración{% endblock %}
{% block page_description %}Configurar el servidor{% endblock %}

{% block content %}
<div x-data="configManager()" x-init="init()">
    <!-- Tabs de categorías -->
    <div class="bg-white rounded-lg shadow mb-6 overflow-hidden">
        <div class="flex overflow-x-auto border-b">
            <template x-for="category in categories" :key="category">
                <button 
                    @click="activeTab = category"
                    :class="activeTab === category ? 'border-primary-600 text-primary-600 bg-primary-50' : 'border-transparent text-gray-600 hover:text-gray-900 hover:bg-gray-50'"
                    class="px-6 py-3 text-sm font-medium border-b-2 whitespace-nowrap transition-all"
                    x-text="category">
                </button>
            </template>
        </div>
    </div>

    <!-- Server Properties por categoría -->
    <div class="bg-white rounded-lg shadow p-6 mb-6">
        <div class="flex items-center justify-between mb-6">
            <div>
                <h3 class="text-xl font-bold text-gray-900" x-text="'Configuración: ' + activeTab"></h3>
                <p class="text-sm text-gray-600 mt-1">Configura las propiedades del servidor Minecraft</p>
            </div>
            <button 
                @click="saveProperties()" 
                :disabled="loading"
                :class="loading ? 'opacity-50 cursor-not-allowed' : ''"
                class="flex items-center gap-2 bg-primary-600 hover:bg-primary-700 text-white px-6 py-2 rounded-lg transition">
                <i data-lucide="save" class="w-4 h-4"></i>
                <span x-text="loading ? 'Guardando...' : 'Guardar Cambios'"></span>
            </button>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <template x-for="prop in getPropertiesByCategory(activeTab)" :key="prop.key">
                <div class="space-y-2">
                    <!-- Label con tooltip -->
                    <div class="flex items-center gap-2">
                        <label :for="prop.key" x-text="prop.label" class="block text-sm font-medium text-gray-700"></label>
                        <div class="relative group">
                            <div class="w-4 h-4 rounded-full bg-gray-300 flex items-center justify-center cursor-help text-white text-xs">
                                ?
                            </div>
                            <!-- Tooltip -->
                            <div class="absolute left-6 top-0 w-64 p-3 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                                <div class="absolute left-0 top-2 w-0 h-0 border-t-4 border-t-transparent border-r-4 border-r-gray-900 border-b-4 border-b-transparent -ml-1"></div>
                                <span x-text="prop.help"></span>
                            </div>
                        </div>
                    </div>

                    <!-- Input según tipo -->
                    <div x-show="prop.type === 'boolean'">
                        <label class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100 transition-colors">
                            <input 
                                type="checkbox" 
                                :id="prop.key"
                                :checked="getPropertyValue(prop.key) === 'true'"
                                @change="setPropertyValue(prop.key, $event.target.checked ? 'true' : 'false')"
                                class="w-5 h-5 text-primary-600 rounded focus:ring-2 focus:ring-primary-500">
                            <span class="text-sm text-gray-700">Activado</span>
                        </label>
                    </div>

                    <div x-show="prop.type === 'select'">
                        <select 
                            :id="prop.key"
                            :value="getPropertyValue(prop.key)"
                            @change="setPropertyValue(prop.key, $event.target.value)"
                            :disabled="prop.key === 'level-type'"
                            :class="prop.key === 'level-type' ? 'w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-100 text-gray-600 cursor-not-allowed' : 'w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500'">
                            <template x-if="prop.options">
                                <template x-for="option in prop.options" :key="option.value">
                                    <option :value="option.value" x-text="option.label" :selected="getPropertyValue(prop.key) === option.value"></option>
                                </template>
                            </template>
                        </select>
                    </div>

                    <div x-show="prop.type === 'number'">
                        <input 
                            type="number"
                            :id="prop.key"
                            :value="getPropertyValue(prop.key)"
                            @input="setPropertyValue(prop.key, $event.target.value)"
                            :min="prop.min || ''"
                            :max="prop.max || ''"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
                    </div>

                    <div x-show="prop.type === 'text' || prop.type === 'password'">
                        <input 
                            :type="prop.type"
                            :id="prop.key"
                            :value="getPropertyValue(prop.key)"
                            :disabled="prop.key === 'level-seed'"
                            :placeholder="prop.key === 'level-seed' ? 'Aleatorio' : ''"
                            @input="setPropertyValue(prop.key, $event.target.value)"
                            :class="prop.key === 'level-seed' ? 'w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-100 text-gray-600 cursor-not-allowed' : 'w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500'">
                    </div>
                </div>
            </template>
        </div>

        <!-- Propiedades adicionales no configuradas -->
        <div class="mt-8 border-t pt-6">
            <details class="group">
                <summary class="cursor-pointer text-sm font-medium text-gray-700 hover:text-gray-900 flex items-center gap-2">
                    <i data-lucide="settings" class="w-4 h-4"></i>
                    Propiedades avanzadas adicionales
                    <i data-lucide="chevron-down" class="w-4 h-4 group-open:rotate-180 transition-transform"></i>
                </summary>
                <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                    <template x-for="(value, key) in properties" :key="key">
                        <div x-show="!Object.keys(SERVER_PROPERTIES_CONFIG).includes(key)">
                            <label :for="'extra-' + key" x-text="key" class="block text-sm font-medium text-gray-700 mb-1"></label>
                            <input 
                                :id="'extra-' + key"
                                :value="value"
                                @input="setPropertyValue(key, $event.target.value)"
                                type="text"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 text-sm">
                        </div>
                    </template>
                </div>
            </details>
        </div>

        <!-- Botón guardar inferior -->
        <div class="mt-6 flex justify-end">
            <button 
                @click="saveProperties()" 
                :disabled="loading"
                :class="loading ? 'opacity-50 cursor-not-allowed' : ''"
                class="flex items-center gap-2 bg-primary-600 hover:bg-primary-700 text-white px-6 py-2 rounded-lg transition">
                <i data-lucide="save" class="w-4 h-4"></i>
                <span x-text="loading ? 'Guardando...' : 'Guardar Cambios'"></span>
            </button>
        </div>
    </div>
    
    <!-- Whitelist -->
    <div class="bg-white rounded-lg shadow p-6">
        <div class="flex items-center gap-2 mb-4">
            <h3 class="text-xl font-bold text-gray-900">Whitelist</h3>
            <div class="relative group">
                <div class="w-4 h-4 rounded-full bg-gray-300 flex items-center justify-center cursor-help text-white text-xs">
                    ?
                </div>
                <div class="absolute left-6 top-0 w-64 p-3 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                    <div class="absolute left-0 top-2 w-0 h-0 border-t-4 border-t-transparent border-r-4 border-r-gray-900 border-b-4 border-b-transparent -ml-1"></div>
                    Lista de jugadores permitidos en el servidor. Activa "Whitelist activa" en la configuración de Protección para usarla.
                </div>
            </div>
        </div>
        <div class="space-y-2">
            <template x-for="(player, index) in whitelist" :key="index">
                <div class="flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 bg-gradient-to-br from-primary-400 to-primary-600 rounded flex items-center justify-center text-white font-bold text-sm">
                            <span x-text="player.name ? player.name[0].toUpperCase() : '?'"></span>
                        </div>
                        <span x-text="player.name" class="font-medium text-gray-900"></span>
                    </div>
                    <button 
                        @click="removeFromWhitelist(index)" 
                        class="text-red-600 hover:text-red-700 hover:bg-red-50 p-2 rounded transition">
                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                    </button>
                </div>
            </template>
            
            <div x-show="whitelist.length === 0" class="text-center py-8 text-gray-500">
                <i data-lucide="users" class="w-12 h-12 mx-auto mb-2 opacity-50"></i>
                <p>No hay jugadores en la whitelist</p>
            </div>
        </div>
    </div>
</div>

<script src="/static/js/components/config.js"></script>
{% endblock %}
